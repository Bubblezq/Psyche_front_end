{"remainingRequest":"D:\\Documents\\GitHub\\Psyche\\front-end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Documents\\GitHub\\Psyche\\front-end\\src\\views\\warehouse\\Map.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\src\\views\\warehouse\\Map.vue","mtime":1575108981838},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1573722996621},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1573725483614},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1573722996621},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\node_modules\\vue-loader\\lib\\index.js","mtime":1573725517685}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport BMap from 'BMap'\r\nimport router from '../../router'\r\nimport warehouseMarker from '../../assets/marker/warehouse.png'\r\nimport usingEquipMarker from '../../assets/marker/usingEquipment.png'\r\nimport {getAllWarehouse, getWarehousePreview, getAll} from '@/api/warehouse'\r\nimport {getEquipmentStoredList, getEquipmentUsingList} from '@/api/equipment'\r\nimport {getAccesoryInWarehouse, getAccessoryInWarehouse} from '@/api/accessory'\r\n\r\n\r\nimport { TreeSelect } from 'ant-design-vue'\r\nvar overlays = []\r\nconst SHOW_PARENT = TreeSelect.SHOW_PARENT\r\nconst functionBox = {\r\n  '0-0': [\"仓库\", getWarehousePreview],\r\n  '0-1': ['在用器材',getEquipmentUsingList],\r\n}\r\n\r\nconst treeData = [{\r\n  title: '仓库',\r\n  value: '0-0',\r\n  key: '0-0',\r\n}, \r\n{\r\n  title: '在用器材',\r\n  value: '0-1',\r\n  key: '0-1',\r\n}]\r\n\r\nfunction refreshMapContainer() {\r\n  var mapContainer = document.getElementById('pleaseresize')\r\n  var h = document.getElementsByClassName('ant-layout-content')[0].offsetHeight\r\n  mapContainer.setAttribute('style', 'height:' + h + 'px;')\r\n}\r\n\r\nconst startPoint = new BMap.Point(116.404, 39.915)\r\n\r\nfunction initialize() {\r\n  const map = new BMap.Map('map')\r\n  window.map = map\r\n  // window.map.centerAndZoom(startPoint, 15)\r\n  map.enableScrollWheelZoom(true)\r\n  // 覆盖区域图层测试\r\n  map.addTileLayer(new BMap.PanoramaCoverageLayer())\r\n  \r\n  var stCtrl = new BMap.PanoramaControl() // 构造全景控件\r\n  stCtrl.setOffset(new BMap.Size(20, 20))\r\n  map.addControl(stCtrl) // 添加全景控件\r\n  var loadCount = 1\r\n  // map.addEventListener('tilesloaded', function () {\r\n  //   if (loadCount === 1) {\r\n  //     map.setCenter(startPoint)\r\n  //   }\r\n  //   loadCount = loadCount + 1\r\n  // })\r\n}\r\n\r\nfunction addTestWarehouseMarker() {\r\n  var pt = new BMap.Point(116.417, 39.909)\r\n  var myIcon = new BMap.Icon(warehouseMarker, new BMap.Size(70, 70))\r\n  var marker = new BMap.Marker(startPoint, { icon: myIcon })\r\n  window.map.addOverlay(marker)\r\n  var marker2 = new BMap.Marker(pt, { icon: myIcon }) // 创建标注\r\n  window.map.addOverlay(marker2) // 将标注添加到地图中\r\n  console.log('Test Marker added!')\r\n}\r\n\r\nexport function jumpWarehouse(id){\r\n  router.push('/warehouse/detail/'+id)\r\n}\r\nwindow.initialize = initialize\r\n\r\nexport default {\r\n  name: 'Map',\r\n  data() {\r\n    return {\r\n      value: ['0-0', '0-1'],\r\n      treeData,\r\n      SHOW_PARENT\r\n    }\r\n  },\r\n  methods: {\r\n    loadScript() {\r\n      var script = document.createElement('script')\r\n      script.src = 'http://api.map.baidu.com/api?v=2.0&ak=CvqBqDrjbtb6R31TBqy5zCFz1fUtuNZQ&callback=initialize'\r\n      document.body.appendChild(script)\r\n      console.log('script appended')\r\n    },\r\n    onChange(value) {\r\n      console.log('onChange ', value)\r\n      this.value = value\r\n      this.refreshMap()\r\n    },\r\n    appendWarehouse(address, id, name, lat, lon){\r\n      var point = new BMap.Point(lon, lat)\r\n      var myIcon = new BMap.Icon(warehouseMarker, new BMap.Size(70, 70))\r\n      var marker = new BMap.Marker(point, { icon: myIcon })\r\n      var sContent =\r\n      `<h4 style='margin:0 0 5px 0;padding:0.2em 0'>${name}</h4>` + \r\n      `<p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em'>${address}</p>` + \r\n      \"</div>\";\r\n      var infoWindow = new BMap.InfoWindow(sContent);\r\n      marker.addEventListener(\"mouseover\", function(){\r\n        this.openInfoWindow(infoWindow)\r\n      })\r\n      marker.addEventListener(\"mouseout\", function(){\r\n        this.closeInfoWindow(infoWindow)\r\n      })\r\n      marker.addEventListener(\"onclick\", function(){\r\n        router.push(\"/warehouse/detail/\" + id)\r\n      })\r\n      overlays.push(marker)\r\n      window.map.addOverlay(marker)\r\n    },\r\n    appendEquipment(address, lat, lon, model, pic, qrCode, type, id){\r\n      var point = new BMap.Point(lon, lat)\r\n      var myIcon = new BMap.Icon(usingEquipMarker, new BMap.Size(70, 70))\r\n      var marker = new BMap.Marker(point, { icon: myIcon })\r\n      var sContent =\r\n      `<h4 style='margin:0 0 5px 0;padding:0.2em 0'>${type} : ${model}</h4>` + \r\n      `<img style='float:right;margin:4px' id='imgDemo' src='${pic}' width='70' height='70' title='${type} : ${model}'/>` +\r\n       `<img style='float:right;margin:4px' id='imgDemo' src='${qrCode}' width='70' height='70' title='${type} : ${model}'/>` +\r\n      `<p style='margin:0;line-height:1.5;font-size:13px;'>${address}</p>` + \r\n      \"</div>\";\r\n      var infoWindow = new BMap.InfoWindow(sContent);\r\n      marker.addEventListener(\"mouseover\", function(){\r\n        this.openInfoWindow(infoWindow)\r\n        document.getElementById('imgDemo').onload = function (){\r\n          infoWindow.redraw();   \r\n        }\r\n      })\r\n      marker.addEventListener(\"mouseout\", function(){\r\n        this.closeInfoWindow(infoWindow)\r\n      })\r\n      marker.addEventListener(\"onclick\", function(){\r\n        router.push(\"/equipment/detail/\" + id)\r\n      })\r\n      overlays.push(marker)\r\n      window.map.addOverlay(marker)\r\n    },\r\n    refreshMap(){\r\n      for(var overlay of overlays){\r\n        window.map.removeOverlay(overlay)\r\n      }\r\n      getAll().then( response =>{\r\n        var warehouses = response.data.warehouse\r\n        var equips = response.data.usingEquipment\r\n        for(var v of this.value){\r\n          var type = functionBox[v][0]\r\n          if(type == \"仓库\"){\r\n            for(var warehouse of warehouses){\r\n              var id = warehouse.id\r\n              var lat = warehouse.lat\r\n              var lon = warehouse.lon\r\n              var name = warehouse.name\r\n              var detailedAddress = warehouse.detailedAddress\r\n              this.appendWarehouse(detailedAddress, id, name, lat, lon)\r\n            }\r\n          }\r\n          else{\r\n            console.log(\"在用器材\")\r\n            for(var equip of equips){\r\n              var detailedAddress = equip.detailedAddress\r\n              var lat = equip.lat\r\n              var lon = equip.lon\r\n              var model = equip.model\r\n              var pic = equip.pic\r\n              var qrCode = equip.qrCode\r\n              var type = equip.type\r\n              var id = equip.id\r\n              this.appendEquipment(detailedAddress, lat, lon, model, pic, qrCode, type, id)\r\n            }\r\n          }\r\n        }\r\n\r\n        console.log(response)\r\n      })\r\n\r\n\r\n\r\n      // for(var v of this.value){\r\n      //   var typeFunctionPair = functionBox[v]\r\n      //   var type = typeFunctionPair[0]\r\n      //   var func = typeFunctionPair[1]\r\n      //   if(type == \"仓库\"){\r\n      //     func().then( response => {\r\n      //         console.log(response.data)\r\n      //         var warehouseData = [...response.data]\r\n      //         for(var warehouse of warehouseData){\r\n      //           var address = warehouse.address\r\n      //           var id = warehouse.id\r\n      //           var name = warehouse.name\r\n      //           console.log(address, id)\r\n      //           this.translateAddress(address, id, name)\r\n      //         }\r\n      //     })\r\n      //   }\r\n      //   else{\r\n      //     func().then( response => {\r\n      //       console.log(response)\r\n      //     })\r\n      //   }\r\n      // }\r\n      var TJJD = new BMap.Point(121.222, 31.291)\r\n      window.map.centerAndZoom(TJJD, 16)\r\n    }\r\n  },\r\n  mounted() {\r\n    // this.loadScript()\r\n    refreshMapContainer()\r\n    // window.onresize = () => {\r\n    //   refreshMapContainer()\r\n    // }\r\n    initialize()\r\n    this.refreshMap()\r\n    // addTestWarehouseMarker()\r\n  }\r\n}\r\n",{"version":3,"sources":["Map.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAwBA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Map.vue","sourceRoot":"src/views/warehouse","sourcesContent":["/* eslint-disable */\r\n\r\n<template>\r\n  <div id=\"pleaseresize\">\r\n    <a-layout id=\"map-components\" style=\"height:100%;\">\r\n      <a-layout-content>\r\n        <div class=\"map\" id=\"map\" style=\"height:100%\"></div>\r\n      </a-layout-content>\r\n      <a-layout-sider theme=\"light\">\r\n        <a-tree-select\r\n          :treeData=\"treeData\"\r\n          :value=\"value\"\r\n          @change=\"onChange\"\r\n          treeCheckable\r\n          :showCheckedStrategy=\"SHOW_PARENT\"\r\n          searchPlaceholder=\"Please select\"\r\n          style=\"width:100%;\"\r\n        />\r\n      </a-layout-sider>\r\n    </a-layout>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport BMap from 'BMap'\r\nimport router from '../../router'\r\nimport warehouseMarker from '../../assets/marker/warehouse.png'\r\nimport usingEquipMarker from '../../assets/marker/usingEquipment.png'\r\nimport {getAllWarehouse, getWarehousePreview, getAll} from '@/api/warehouse'\r\nimport {getEquipmentStoredList, getEquipmentUsingList} from '@/api/equipment'\r\nimport {getAccesoryInWarehouse, getAccessoryInWarehouse} from '@/api/accessory'\r\n\r\n\r\nimport { TreeSelect } from 'ant-design-vue'\r\nvar overlays = []\r\nconst SHOW_PARENT = TreeSelect.SHOW_PARENT\r\nconst functionBox = {\r\n  '0-0': [\"仓库\", getWarehousePreview],\r\n  '0-1': ['在用器材',getEquipmentUsingList],\r\n}\r\n\r\nconst treeData = [{\r\n  title: '仓库',\r\n  value: '0-0',\r\n  key: '0-0',\r\n}, \r\n{\r\n  title: '在用器材',\r\n  value: '0-1',\r\n  key: '0-1',\r\n}]\r\n\r\nfunction refreshMapContainer() {\r\n  var mapContainer = document.getElementById('pleaseresize')\r\n  var h = document.getElementsByClassName('ant-layout-content')[0].offsetHeight\r\n  mapContainer.setAttribute('style', 'height:' + h + 'px;')\r\n}\r\n\r\nconst startPoint = new BMap.Point(116.404, 39.915)\r\n\r\nfunction initialize() {\r\n  const map = new BMap.Map('map')\r\n  window.map = map\r\n  // window.map.centerAndZoom(startPoint, 15)\r\n  map.enableScrollWheelZoom(true)\r\n  // 覆盖区域图层测试\r\n  map.addTileLayer(new BMap.PanoramaCoverageLayer())\r\n  \r\n  var stCtrl = new BMap.PanoramaControl() // 构造全景控件\r\n  stCtrl.setOffset(new BMap.Size(20, 20))\r\n  map.addControl(stCtrl) // 添加全景控件\r\n  var loadCount = 1\r\n  // map.addEventListener('tilesloaded', function () {\r\n  //   if (loadCount === 1) {\r\n  //     map.setCenter(startPoint)\r\n  //   }\r\n  //   loadCount = loadCount + 1\r\n  // })\r\n}\r\n\r\nfunction addTestWarehouseMarker() {\r\n  var pt = new BMap.Point(116.417, 39.909)\r\n  var myIcon = new BMap.Icon(warehouseMarker, new BMap.Size(70, 70))\r\n  var marker = new BMap.Marker(startPoint, { icon: myIcon })\r\n  window.map.addOverlay(marker)\r\n  var marker2 = new BMap.Marker(pt, { icon: myIcon }) // 创建标注\r\n  window.map.addOverlay(marker2) // 将标注添加到地图中\r\n  console.log('Test Marker added!')\r\n}\r\n\r\nexport function jumpWarehouse(id){\r\n  router.push('/warehouse/detail/'+id)\r\n}\r\nwindow.initialize = initialize\r\n\r\nexport default {\r\n  name: 'Map',\r\n  data() {\r\n    return {\r\n      value: ['0-0', '0-1'],\r\n      treeData,\r\n      SHOW_PARENT\r\n    }\r\n  },\r\n  methods: {\r\n    loadScript() {\r\n      var script = document.createElement('script')\r\n      script.src = 'http://api.map.baidu.com/api?v=2.0&ak=CvqBqDrjbtb6R31TBqy5zCFz1fUtuNZQ&callback=initialize'\r\n      document.body.appendChild(script)\r\n      console.log('script appended')\r\n    },\r\n    onChange(value) {\r\n      console.log('onChange ', value)\r\n      this.value = value\r\n      this.refreshMap()\r\n    },\r\n    appendWarehouse(address, id, name, lat, lon){\r\n      var point = new BMap.Point(lon, lat)\r\n      var myIcon = new BMap.Icon(warehouseMarker, new BMap.Size(70, 70))\r\n      var marker = new BMap.Marker(point, { icon: myIcon })\r\n      var sContent =\r\n      `<h4 style='margin:0 0 5px 0;padding:0.2em 0'>${name}</h4>` + \r\n      `<p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em'>${address}</p>` + \r\n      \"</div>\";\r\n      var infoWindow = new BMap.InfoWindow(sContent);\r\n      marker.addEventListener(\"mouseover\", function(){\r\n        this.openInfoWindow(infoWindow)\r\n      })\r\n      marker.addEventListener(\"mouseout\", function(){\r\n        this.closeInfoWindow(infoWindow)\r\n      })\r\n      marker.addEventListener(\"onclick\", function(){\r\n        router.push(\"/warehouse/detail/\" + id)\r\n      })\r\n      overlays.push(marker)\r\n      window.map.addOverlay(marker)\r\n    },\r\n    appendEquipment(address, lat, lon, model, pic, qrCode, type, id){\r\n      var point = new BMap.Point(lon, lat)\r\n      var myIcon = new BMap.Icon(usingEquipMarker, new BMap.Size(70, 70))\r\n      var marker = new BMap.Marker(point, { icon: myIcon })\r\n      var sContent =\r\n      `<h4 style='margin:0 0 5px 0;padding:0.2em 0'>${type} : ${model}</h4>` + \r\n      `<img style='float:right;margin:4px' id='imgDemo' src='${pic}' width='70' height='70' title='${type} : ${model}'/>` +\r\n       `<img style='float:right;margin:4px' id='imgDemo' src='${qrCode}' width='70' height='70' title='${type} : ${model}'/>` +\r\n      `<p style='margin:0;line-height:1.5;font-size:13px;'>${address}</p>` + \r\n      \"</div>\";\r\n      var infoWindow = new BMap.InfoWindow(sContent);\r\n      marker.addEventListener(\"mouseover\", function(){\r\n        this.openInfoWindow(infoWindow)\r\n        document.getElementById('imgDemo').onload = function (){\r\n          infoWindow.redraw();   \r\n        }\r\n      })\r\n      marker.addEventListener(\"mouseout\", function(){\r\n        this.closeInfoWindow(infoWindow)\r\n      })\r\n      marker.addEventListener(\"onclick\", function(){\r\n        router.push(\"/equipment/detail/\" + id)\r\n      })\r\n      overlays.push(marker)\r\n      window.map.addOverlay(marker)\r\n    },\r\n    refreshMap(){\r\n      for(var overlay of overlays){\r\n        window.map.removeOverlay(overlay)\r\n      }\r\n      getAll().then( response =>{\r\n        var warehouses = response.data.warehouse\r\n        var equips = response.data.usingEquipment\r\n        for(var v of this.value){\r\n          var type = functionBox[v][0]\r\n          if(type == \"仓库\"){\r\n            for(var warehouse of warehouses){\r\n              var id = warehouse.id\r\n              var lat = warehouse.lat\r\n              var lon = warehouse.lon\r\n              var name = warehouse.name\r\n              var detailedAddress = warehouse.detailedAddress\r\n              this.appendWarehouse(detailedAddress, id, name, lat, lon)\r\n            }\r\n          }\r\n          else{\r\n            console.log(\"在用器材\")\r\n            for(var equip of equips){\r\n              var detailedAddress = equip.detailedAddress\r\n              var lat = equip.lat\r\n              var lon = equip.lon\r\n              var model = equip.model\r\n              var pic = equip.pic\r\n              var qrCode = equip.qrCode\r\n              var type = equip.type\r\n              var id = equip.id\r\n              this.appendEquipment(detailedAddress, lat, lon, model, pic, qrCode, type, id)\r\n            }\r\n          }\r\n        }\r\n\r\n        console.log(response)\r\n      })\r\n\r\n\r\n\r\n      // for(var v of this.value){\r\n      //   var typeFunctionPair = functionBox[v]\r\n      //   var type = typeFunctionPair[0]\r\n      //   var func = typeFunctionPair[1]\r\n      //   if(type == \"仓库\"){\r\n      //     func().then( response => {\r\n      //         console.log(response.data)\r\n      //         var warehouseData = [...response.data]\r\n      //         for(var warehouse of warehouseData){\r\n      //           var address = warehouse.address\r\n      //           var id = warehouse.id\r\n      //           var name = warehouse.name\r\n      //           console.log(address, id)\r\n      //           this.translateAddress(address, id, name)\r\n      //         }\r\n      //     })\r\n      //   }\r\n      //   else{\r\n      //     func().then( response => {\r\n      //       console.log(response)\r\n      //     })\r\n      //   }\r\n      // }\r\n      var TJJD = new BMap.Point(121.222, 31.291)\r\n      window.map.centerAndZoom(TJJD, 16)\r\n    }\r\n  },\r\n  mounted() {\r\n    // this.loadScript()\r\n    refreshMapContainer()\r\n    // window.onresize = () => {\r\n    //   refreshMapContainer()\r\n    // }\r\n    initialize()\r\n    this.refreshMap()\r\n    // addTestWarehouseMarker()\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n/* #map-components {\r\n    width:50%;\r\n    height: 100%;\r\n  }\r\n  #map {\r\n    height: 100%;\r\n  }\r\n  #container {\r\n    height: 100%;\r\n  } */\r\n\r\n.checkbox-vertical {\r\n  display: block;\r\n  margin-right: 0;\r\n}\r\n\r\n/* #map-layout{\r\n    height: 100%;\r\n  } */\r\n\r\n/* .ant-layout-content{\r\n    height: 100%;\r\n  } */\r\n/* html,body{\r\n    width: 100%;\r\n    height: 100%;\r\n  } */\r\n</style>\r\n"]}]}