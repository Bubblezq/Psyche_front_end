{"remainingRequest":"D:\\Documents\\GitHub\\Psyche\\front-end\\node_modules\\babel-loader\\lib\\index.js!D:\\Documents\\GitHub\\Psyche\\front-end\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\Documents\\GitHub\\Psyche\\front-end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Documents\\GitHub\\Psyche\\front-end\\src\\views\\warehouse\\Map.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\src\\views\\warehouse\\Map.vue","mtime":1575108981838},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1573722996621},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1573725483614},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1573722996621},{"path":"D:\\Documents\\GitHub\\Psyche\\front-end\\node_modules\\vue-loader\\lib\\index.js","mtime":1573725517685}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport _getIterator from \"D:\\\\Documents\\\\GitHub\\\\Psyche\\\\front-end\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/get-iterator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport BMap from 'BMap';\nimport router from '../../router';\nimport warehouseMarker from '../../assets/marker/warehouse.png';\nimport usingEquipMarker from '../../assets/marker/usingEquipment.png';\nimport { getAllWarehouse, getWarehousePreview, getAll } from '@/api/warehouse';\nimport { getEquipmentStoredList, getEquipmentUsingList } from '@/api/equipment';\nimport { getAccesoryInWarehouse, getAccessoryInWarehouse } from '@/api/accessory';\nimport { TreeSelect } from 'ant-design-vue';\nvar overlays = [];\nvar SHOW_PARENT = TreeSelect.SHOW_PARENT;\nvar functionBox = {\n  '0-0': [\"仓库\", getWarehousePreview],\n  '0-1': ['在用器材', getEquipmentUsingList]\n};\nvar treeData = [{\n  title: '仓库',\n  value: '0-0',\n  key: '0-0'\n}, {\n  title: '在用器材',\n  value: '0-1',\n  key: '0-1'\n}];\n\nfunction refreshMapContainer() {\n  var mapContainer = document.getElementById('pleaseresize');\n  var h = document.getElementsByClassName('ant-layout-content')[0].offsetHeight;\n  mapContainer.setAttribute('style', 'height:' + h + 'px;');\n}\n\nvar startPoint = new BMap.Point(116.404, 39.915);\n\nfunction initialize() {\n  var map = new BMap.Map('map');\n  window.map = map; // window.map.centerAndZoom(startPoint, 15)\n\n  map.enableScrollWheelZoom(true); // 覆盖区域图层测试\n\n  map.addTileLayer(new BMap.PanoramaCoverageLayer());\n  var stCtrl = new BMap.PanoramaControl(); // 构造全景控件\n\n  stCtrl.setOffset(new BMap.Size(20, 20));\n  map.addControl(stCtrl); // 添加全景控件\n\n  var loadCount = 1; // map.addEventListener('tilesloaded', function () {\n  //   if (loadCount === 1) {\n  //     map.setCenter(startPoint)\n  //   }\n  //   loadCount = loadCount + 1\n  // })\n}\n\nfunction addTestWarehouseMarker() {\n  var pt = new BMap.Point(116.417, 39.909);\n  var myIcon = new BMap.Icon(warehouseMarker, new BMap.Size(70, 70));\n  var marker = new BMap.Marker(startPoint, {\n    icon: myIcon\n  });\n  window.map.addOverlay(marker);\n  var marker2 = new BMap.Marker(pt, {\n    icon: myIcon\n  }); // 创建标注\n\n  window.map.addOverlay(marker2); // 将标注添加到地图中\n\n  console.log('Test Marker added!');\n}\n\nexport function jumpWarehouse(id) {\n  router.push('/warehouse/detail/' + id);\n}\nwindow.initialize = initialize;\nexport default {\n  name: 'Map',\n  data: function data() {\n    return {\n      value: ['0-0', '0-1'],\n      treeData: treeData,\n      SHOW_PARENT: SHOW_PARENT\n    };\n  },\n  methods: {\n    loadScript: function loadScript() {\n      var script = document.createElement('script');\n      script.src = 'http://api.map.baidu.com/api?v=2.0&ak=CvqBqDrjbtb6R31TBqy5zCFz1fUtuNZQ&callback=initialize';\n      document.body.appendChild(script);\n      console.log('script appended');\n    },\n    onChange: function onChange(value) {\n      console.log('onChange ', value);\n      this.value = value;\n      this.refreshMap();\n    },\n    appendWarehouse: function appendWarehouse(address, id, name, lat, lon) {\n      var point = new BMap.Point(lon, lat);\n      var myIcon = new BMap.Icon(warehouseMarker, new BMap.Size(70, 70));\n      var marker = new BMap.Marker(point, {\n        icon: myIcon\n      });\n      var sContent = \"<h4 style='margin:0 0 5px 0;padding:0.2em 0'>\".concat(name, \"</h4>\") + \"<p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em'>\".concat(address, \"</p>\") + \"</div>\";\n      var infoWindow = new BMap.InfoWindow(sContent);\n      marker.addEventListener(\"mouseover\", function () {\n        this.openInfoWindow(infoWindow);\n      });\n      marker.addEventListener(\"mouseout\", function () {\n        this.closeInfoWindow(infoWindow);\n      });\n      marker.addEventListener(\"onclick\", function () {\n        router.push(\"/warehouse/detail/\" + id);\n      });\n      overlays.push(marker);\n      window.map.addOverlay(marker);\n    },\n    appendEquipment: function appendEquipment(address, lat, lon, model, pic, qrCode, type, id) {\n      var point = new BMap.Point(lon, lat);\n      var myIcon = new BMap.Icon(usingEquipMarker, new BMap.Size(70, 70));\n      var marker = new BMap.Marker(point, {\n        icon: myIcon\n      });\n      var sContent = \"<h4 style='margin:0 0 5px 0;padding:0.2em 0'>\".concat(type, \" : \").concat(model, \"</h4>\") + \"<img style='float:right;margin:4px' id='imgDemo' src='\".concat(pic, \"' width='70' height='70' title='\").concat(type, \" : \").concat(model, \"'/>\") + \"<img style='float:right;margin:4px' id='imgDemo' src='\".concat(qrCode, \"' width='70' height='70' title='\").concat(type, \" : \").concat(model, \"'/>\") + \"<p style='margin:0;line-height:1.5;font-size:13px;'>\".concat(address, \"</p>\") + \"</div>\";\n      var infoWindow = new BMap.InfoWindow(sContent);\n      marker.addEventListener(\"mouseover\", function () {\n        this.openInfoWindow(infoWindow);\n\n        document.getElementById('imgDemo').onload = function () {\n          infoWindow.redraw();\n        };\n      });\n      marker.addEventListener(\"mouseout\", function () {\n        this.closeInfoWindow(infoWindow);\n      });\n      marker.addEventListener(\"onclick\", function () {\n        router.push(\"/equipment/detail/\" + id);\n      });\n      overlays.push(marker);\n      window.map.addOverlay(marker);\n    },\n    refreshMap: function refreshMap() {\n      var _this = this;\n\n      for (var _i = 0; _i < overlays.length; _i++) {\n        var overlay = overlays[_i];\n        window.map.removeOverlay(overlay);\n      }\n\n      getAll().then(function (response) {\n        var warehouses = response.data.warehouse;\n        var equips = response.data.usingEquipment;\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          for (var _iterator = _getIterator(_this.value), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var v = _step.value;\n            var type = functionBox[v][0];\n\n            if (type == \"仓库\") {\n              var _iteratorNormalCompletion2 = true;\n              var _didIteratorError2 = false;\n              var _iteratorError2 = undefined;\n\n              try {\n                for (var _iterator2 = _getIterator(warehouses), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n                  var warehouse = _step2.value;\n                  var id = warehouse.id;\n                  var lat = warehouse.lat;\n                  var lon = warehouse.lon;\n                  var name = warehouse.name;\n                  var detailedAddress = warehouse.detailedAddress;\n\n                  _this.appendWarehouse(detailedAddress, id, name, lat, lon);\n                }\n              } catch (err) {\n                _didIteratorError2 = true;\n                _iteratorError2 = err;\n              } finally {\n                try {\n                  if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n                    _iterator2.return();\n                  }\n                } finally {\n                  if (_didIteratorError2) {\n                    throw _iteratorError2;\n                  }\n                }\n              }\n            } else {\n              console.log(\"在用器材\");\n              var _iteratorNormalCompletion3 = true;\n              var _didIteratorError3 = false;\n              var _iteratorError3 = undefined;\n\n              try {\n                for (var _iterator3 = _getIterator(equips), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n                  var equip = _step3.value;\n                  var detailedAddress = equip.detailedAddress;\n                  var lat = equip.lat;\n                  var lon = equip.lon;\n                  var model = equip.model;\n                  var pic = equip.pic;\n                  var qrCode = equip.qrCode;\n                  var type = equip.type;\n                  var id = equip.id;\n\n                  _this.appendEquipment(detailedAddress, lat, lon, model, pic, qrCode, type, id);\n                }\n              } catch (err) {\n                _didIteratorError3 = true;\n                _iteratorError3 = err;\n              } finally {\n                try {\n                  if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n                    _iterator3.return();\n                  }\n                } finally {\n                  if (_didIteratorError3) {\n                    throw _iteratorError3;\n                  }\n                }\n              }\n            }\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator.return != null) {\n              _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n\n        console.log(response);\n      }); // for(var v of this.value){\n      //   var typeFunctionPair = functionBox[v]\n      //   var type = typeFunctionPair[0]\n      //   var func = typeFunctionPair[1]\n      //   if(type == \"仓库\"){\n      //     func().then( response => {\n      //         console.log(response.data)\n      //         var warehouseData = [...response.data]\n      //         for(var warehouse of warehouseData){\n      //           var address = warehouse.address\n      //           var id = warehouse.id\n      //           var name = warehouse.name\n      //           console.log(address, id)\n      //           this.translateAddress(address, id, name)\n      //         }\n      //     })\n      //   }\n      //   else{\n      //     func().then( response => {\n      //       console.log(response)\n      //     })\n      //   }\n      // }\n\n      var TJJD = new BMap.Point(121.222, 31.291);\n      window.map.centerAndZoom(TJJD, 16);\n    }\n  },\n  mounted: function mounted() {\n    // this.loadScript()\n    refreshMapContainer(); // window.onresize = () => {\n    //   refreshMapContainer()\n    // }\n\n    initialize();\n    this.refreshMap(); // addTestWarehouseMarker()\n  }\n};",{"version":3,"sources":["Map.vue"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable */\r\n\r\n<template>\r\n  <div id=\"pleaseresize\">\r\n    <a-layout id=\"map-components\" style=\"height:100%;\">\r\n      <a-layout-content>\r\n        <div class=\"map\" id=\"map\" style=\"height:100%\"></div>\r\n      </a-layout-content>\r\n      <a-layout-sider theme=\"light\">\r\n        <a-tree-select\r\n          :treeData=\"treeData\"\r\n          :value=\"value\"\r\n          @change=\"onChange\"\r\n          treeCheckable\r\n          :showCheckedStrategy=\"SHOW_PARENT\"\r\n          searchPlaceholder=\"Please select\"\r\n          style=\"width:100%;\"\r\n        />\r\n      </a-layout-sider>\r\n    </a-layout>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport BMap from 'BMap'\r\nimport router from '../../router'\r\nimport warehouseMarker from '../../assets/marker/warehouse.png'\r\nimport usingEquipMarker from '../../assets/marker/usingEquipment.png'\r\nimport {getAllWarehouse, getWarehousePreview, getAll} from '@/api/warehouse'\r\nimport {getEquipmentStoredList, getEquipmentUsingList} from '@/api/equipment'\r\nimport {getAccesoryInWarehouse, getAccessoryInWarehouse} from '@/api/accessory'\r\n\r\n\r\nimport { TreeSelect } from 'ant-design-vue'\r\nvar overlays = []\r\nconst SHOW_PARENT = TreeSelect.SHOW_PARENT\r\nconst functionBox = {\r\n  '0-0': [\"仓库\", getWarehousePreview],\r\n  '0-1': ['在用器材',getEquipmentUsingList],\r\n}\r\n\r\nconst treeData = [{\r\n  title: '仓库',\r\n  value: '0-0',\r\n  key: '0-0',\r\n}, \r\n{\r\n  title: '在用器材',\r\n  value: '0-1',\r\n  key: '0-1',\r\n}]\r\n\r\nfunction refreshMapContainer() {\r\n  var mapContainer = document.getElementById('pleaseresize')\r\n  var h = document.getElementsByClassName('ant-layout-content')[0].offsetHeight\r\n  mapContainer.setAttribute('style', 'height:' + h + 'px;')\r\n}\r\n\r\nconst startPoint = new BMap.Point(116.404, 39.915)\r\n\r\nfunction initialize() {\r\n  const map = new BMap.Map('map')\r\n  window.map = map\r\n  // window.map.centerAndZoom(startPoint, 15)\r\n  map.enableScrollWheelZoom(true)\r\n  // 覆盖区域图层测试\r\n  map.addTileLayer(new BMap.PanoramaCoverageLayer())\r\n  \r\n  var stCtrl = new BMap.PanoramaControl() // 构造全景控件\r\n  stCtrl.setOffset(new BMap.Size(20, 20))\r\n  map.addControl(stCtrl) // 添加全景控件\r\n  var loadCount = 1\r\n  // map.addEventListener('tilesloaded', function () {\r\n  //   if (loadCount === 1) {\r\n  //     map.setCenter(startPoint)\r\n  //   }\r\n  //   loadCount = loadCount + 1\r\n  // })\r\n}\r\n\r\nfunction addTestWarehouseMarker() {\r\n  var pt = new BMap.Point(116.417, 39.909)\r\n  var myIcon = new BMap.Icon(warehouseMarker, new BMap.Size(70, 70))\r\n  var marker = new BMap.Marker(startPoint, { icon: myIcon })\r\n  window.map.addOverlay(marker)\r\n  var marker2 = new BMap.Marker(pt, { icon: myIcon }) // 创建标注\r\n  window.map.addOverlay(marker2) // 将标注添加到地图中\r\n  console.log('Test Marker added!')\r\n}\r\n\r\nexport function jumpWarehouse(id){\r\n  router.push('/warehouse/detail/'+id)\r\n}\r\nwindow.initialize = initialize\r\n\r\nexport default {\r\n  name: 'Map',\r\n  data() {\r\n    return {\r\n      value: ['0-0', '0-1'],\r\n      treeData,\r\n      SHOW_PARENT\r\n    }\r\n  },\r\n  methods: {\r\n    loadScript() {\r\n      var script = document.createElement('script')\r\n      script.src = 'http://api.map.baidu.com/api?v=2.0&ak=CvqBqDrjbtb6R31TBqy5zCFz1fUtuNZQ&callback=initialize'\r\n      document.body.appendChild(script)\r\n      console.log('script appended')\r\n    },\r\n    onChange(value) {\r\n      console.log('onChange ', value)\r\n      this.value = value\r\n      this.refreshMap()\r\n    },\r\n    appendWarehouse(address, id, name, lat, lon){\r\n      var point = new BMap.Point(lon, lat)\r\n      var myIcon = new BMap.Icon(warehouseMarker, new BMap.Size(70, 70))\r\n      var marker = new BMap.Marker(point, { icon: myIcon })\r\n      var sContent =\r\n      `<h4 style='margin:0 0 5px 0;padding:0.2em 0'>${name}</h4>` + \r\n      `<p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em'>${address}</p>` + \r\n      \"</div>\";\r\n      var infoWindow = new BMap.InfoWindow(sContent);\r\n      marker.addEventListener(\"mouseover\", function(){\r\n        this.openInfoWindow(infoWindow)\r\n      })\r\n      marker.addEventListener(\"mouseout\", function(){\r\n        this.closeInfoWindow(infoWindow)\r\n      })\r\n      marker.addEventListener(\"onclick\", function(){\r\n        router.push(\"/warehouse/detail/\" + id)\r\n      })\r\n      overlays.push(marker)\r\n      window.map.addOverlay(marker)\r\n    },\r\n    appendEquipment(address, lat, lon, model, pic, qrCode, type, id){\r\n      var point = new BMap.Point(lon, lat)\r\n      var myIcon = new BMap.Icon(usingEquipMarker, new BMap.Size(70, 70))\r\n      var marker = new BMap.Marker(point, { icon: myIcon })\r\n      var sContent =\r\n      `<h4 style='margin:0 0 5px 0;padding:0.2em 0'>${type} : ${model}</h4>` + \r\n      `<img style='float:right;margin:4px' id='imgDemo' src='${pic}' width='70' height='70' title='${type} : ${model}'/>` +\r\n       `<img style='float:right;margin:4px' id='imgDemo' src='${qrCode}' width='70' height='70' title='${type} : ${model}'/>` +\r\n      `<p style='margin:0;line-height:1.5;font-size:13px;'>${address}</p>` + \r\n      \"</div>\";\r\n      var infoWindow = new BMap.InfoWindow(sContent);\r\n      marker.addEventListener(\"mouseover\", function(){\r\n        this.openInfoWindow(infoWindow)\r\n        document.getElementById('imgDemo').onload = function (){\r\n          infoWindow.redraw();   \r\n        }\r\n      })\r\n      marker.addEventListener(\"mouseout\", function(){\r\n        this.closeInfoWindow(infoWindow)\r\n      })\r\n      marker.addEventListener(\"onclick\", function(){\r\n        router.push(\"/equipment/detail/\" + id)\r\n      })\r\n      overlays.push(marker)\r\n      window.map.addOverlay(marker)\r\n    },\r\n    refreshMap(){\r\n      for(var overlay of overlays){\r\n        window.map.removeOverlay(overlay)\r\n      }\r\n      getAll().then( response =>{\r\n        var warehouses = response.data.warehouse\r\n        var equips = response.data.usingEquipment\r\n        for(var v of this.value){\r\n          var type = functionBox[v][0]\r\n          if(type == \"仓库\"){\r\n            for(var warehouse of warehouses){\r\n              var id = warehouse.id\r\n              var lat = warehouse.lat\r\n              var lon = warehouse.lon\r\n              var name = warehouse.name\r\n              var detailedAddress = warehouse.detailedAddress\r\n              this.appendWarehouse(detailedAddress, id, name, lat, lon)\r\n            }\r\n          }\r\n          else{\r\n            console.log(\"在用器材\")\r\n            for(var equip of equips){\r\n              var detailedAddress = equip.detailedAddress\r\n              var lat = equip.lat\r\n              var lon = equip.lon\r\n              var model = equip.model\r\n              var pic = equip.pic\r\n              var qrCode = equip.qrCode\r\n              var type = equip.type\r\n              var id = equip.id\r\n              this.appendEquipment(detailedAddress, lat, lon, model, pic, qrCode, type, id)\r\n            }\r\n          }\r\n        }\r\n\r\n        console.log(response)\r\n      })\r\n\r\n\r\n\r\n      // for(var v of this.value){\r\n      //   var typeFunctionPair = functionBox[v]\r\n      //   var type = typeFunctionPair[0]\r\n      //   var func = typeFunctionPair[1]\r\n      //   if(type == \"仓库\"){\r\n      //     func().then( response => {\r\n      //         console.log(response.data)\r\n      //         var warehouseData = [...response.data]\r\n      //         for(var warehouse of warehouseData){\r\n      //           var address = warehouse.address\r\n      //           var id = warehouse.id\r\n      //           var name = warehouse.name\r\n      //           console.log(address, id)\r\n      //           this.translateAddress(address, id, name)\r\n      //         }\r\n      //     })\r\n      //   }\r\n      //   else{\r\n      //     func().then( response => {\r\n      //       console.log(response)\r\n      //     })\r\n      //   }\r\n      // }\r\n      var TJJD = new BMap.Point(121.222, 31.291)\r\n      window.map.centerAndZoom(TJJD, 16)\r\n    }\r\n  },\r\n  mounted() {\r\n    // this.loadScript()\r\n    refreshMapContainer()\r\n    // window.onresize = () => {\r\n    //   refreshMapContainer()\r\n    // }\r\n    initialize()\r\n    this.refreshMap()\r\n    // addTestWarehouseMarker()\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n/* #map-components {\r\n    width:50%;\r\n    height: 100%;\r\n  }\r\n  #map {\r\n    height: 100%;\r\n  }\r\n  #container {\r\n    height: 100%;\r\n  } */\r\n\r\n.checkbox-vertical {\r\n  display: block;\r\n  margin-right: 0;\r\n}\r\n\r\n/* #map-layout{\r\n    height: 100%;\r\n  } */\r\n\r\n/* .ant-layout-content{\r\n    height: 100%;\r\n  } */\r\n/* html,body{\r\n    width: 100%;\r\n    height: 100%;\r\n  } */\r\n</style>\r\n"],"sourceRoot":"src/views/warehouse"}]}